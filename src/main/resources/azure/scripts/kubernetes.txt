#
# set cluster & resource group names
#
clusterName="selenium-cluster" && \
rgName="dev-support-3777090-rg"

#
# create resource group
#
az group create \
  --name $rgName \
  --location eastus

#
# create managed Kubernetes cluster
#
az aks create \
  --resource-group $rgName \
  --name $clusterName \
  --dns-name-prefix selenium-3777090 \
  --node-vm-size Standard_B2s \
  --node-count 5 \
  --generate-ssh-keys
#  --enable-addons monitoring,http_application_routing

#
# activate credentials for newly created AKS cluster
#
az aks get-credentials \
  --resource-group $rgName \
  --name $clusterName

#
# verify connection to cluster
#
kubectl get nodes

#
# deploy selenium hub
# 
kubectl apply -f /home/romeo/selenium-hub-deployment.yaml

#
# verify hub deployment
#
#kubectl get deploy selenium-hub
kubectl get pods

#
# deploy hub service so the nodes can locate the hub
# ???
kubectl apply -f /home/romeo/selenium-hub-service.yaml

# then
kubectl get svc selenium-service
kubectl describe node selenium-hub

kubectl get service selenium-service

#
# verify hub service
#
kubectl get service selenium-hub

#
# start kubernetes in browser
#
az aks browse -g $rgName -n $clusterName

http://selenium-3777090-4ec2f16e.hcp.eastus.azmk8s.io:30001/grid/console

#
# TO GET ADMIN TOKEN
# first, set admin credentials

az aks get-credentials -a \
  --resource-group $rgName \
  --name $clusterName

# then download /home/romeo/.kube/config
# ...to use as kubernetes file for logon
# (remember to enable pop-ups from portal in firefox)

#
# deploy firefox node
#
kubectl create -f /home/romeo/selenium-replic-firefox.yaml
kubectl create -f /home/romeo/selenium-replic-chrome.yaml

#
# validate setup, then RUN TEST !
#


#
# clean up
#
az aks delete -g dev-support-3777090-rg -n selenium-cluster
az group delete --name dev-support-3777090-rg
kubectl config delete-context selenium-cluster

=======================================================

# query Azure DNS zone list (??)
az network dns zone list --output table

#
# deploy ingress
#
kubectl apply -f /home/romeo/ingress.yaml

# verify ingress deployment
kubectl get ingress selenium-ingress

#
# Look into this ???
#
az network dns record-set list \
   -g mc_music-albums-rg_selenium-cluster_eastus \
   -z 46b399436d2b440caf49.eastus.aksapp.io \
   --output table

#
# start kubernetes in browser
#
az aks browse -g $rgName -n $clusterName

# TO GET ADMIN TOKEN
kubectl config view

=======================================================

#
# ?? ID of the service principal configured for the AKS instance
# (AFTER creation of AKS)
#
clientId=$(az aks show \
  --name $clusterName \
  --resource-group $rgName \
  --query "servicePrincipalProfile.clientId" \
  --output tsv)

# ?
kubectl describe deployment $clusterName --namespace default

#
# run kubernetes hub
#

# run selenium hub image
kubectl run selenium-cluster --image selenium/hub:3.3.0 --port 4444

# ?... (look into this)
kubectl expose deployment $clusterName --type=LoadBalancer --name=selenium-grid??

# what does this do ?
#kubectl get service selenium-hub --watch
#kubectl get service selenium-service --watch
# selenium-service = ClusterIP
# selenium-hub = Selenium Grid (need to load in Node ??)
...




